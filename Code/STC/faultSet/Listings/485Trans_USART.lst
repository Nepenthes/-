C51 COMPILER V9.54   485TRANS_USART                                                        03/08/2018 16:33:08 PAGE 1   


C51 COMPILER V9.54, COMPILATION OF MODULE 485TRANS_USART
OBJECT MODULE PLACED IN .\Objects\485Trans_USART.obj
COMPILER INVOKED BY: D:\Keil\Software\C51\BIN\C51.EXE Hardware\485Trans_USART.c OMF2 OPTIMIZE(8,SPEED) BROWSE INCDIR(..\
                    -faultSet;.\User;.\Hardware;.\StdPeriph_Driver) DEBUG PRINT(.\Listings\485Trans_USART.lst) OBJECT(.\Objects\485Trans_USAR
                    -T.obj)

line level    source

   1          #include "485Trans_USART.h"
   2          
   3          extern u8 BD_addr,BD_type;       //…Ëπ ∞Âµÿ÷∑º∞¿‡–Õ
   4          
   5          const u8 flgCfmHead = FRAME_HEAD;                               //÷°Õ∑±Íº«
   6          const u8 frameCfmTail[2] = {0x0d,0x0a};         //÷°Œ≤À¿≤ª±‰
   7          u8 frameCfmHead[4] = {0};                                                       //÷°Õ∑”…÷°Õ∑±Íº«°¢…Ëπ ∞Â◊®”√Õ®–≈µÿ÷∑°¢±æµÿ…Ëπ ∞Âµÿ÷∑°¢±æµÿ…Ëπ ∞Â¿‡–Õ◊È≥…
   8          
   9          extern u8 xdata UART485_BUF[COM_RX2_Lenth];     //485¥Æø⁄ ˝æ›ª∫¥Ê
  10          
  11          u8 COREDATS[COREDATS_SIZE] = {0};               //÷°∫À ˝æ›ª∫¥Ê
  12          
  13          void USART485Trans_Init(void){  //485Õ®—∂Ω”ø⁄≥ı ºªØ
  14   1      
  15   1              GPIO_InitTypeDef gpio_485;
  16   1              COMx_InitDefine  UART485Port;
  17   1              
  18   1              gpio_485.Mode = GPIO_OUT_PP;
  19   1              gpio_485.Pin  = GPIO_Pin_2;
  20   1              GPIO_Inilize(GPIO_P1,&gpio_485);
  21   1              
  22   1              UART485Port.UART_Mode = UART_8bit_BRTx;
  23   1              UART485Port.UART_BRT_Use = BRT_Timer2;
  24   1              UART485Port.UART_BaudRate = 38400UL;
  25   1              UART485Port.Morecommunicate = DISABLE;
  26   1              UART485Port.UART_RxEnable = ENABLE;
  27   1              UART485Port.BaudRateDouble = DISABLE;
  28   1              UART485Port.UART_Interrupt = ENABLE;
  29   1              UART485Port.UART_Polity = PolityHigh;
  30   1              UART485Port.UART_P_SW = UART2_SW_P10_P11; 
  31   1              UART485Port.UART_RXD_TXD_Short = DISABLE;
  32   1              USART_Configuration(USART2,&UART485Port);
  33   1              
  34   1              RD485; //≥ı ºªØø™∆ÙΩ” ‹ πƒ‹
  35   1      }
  36          
  37          void frameInsAccept(void){      // ˝æ›—È ’
  38   1      
  39   1              u8 loop,corelen;
  40   1              
  41   1              frameCfmHead[0] = flgCfmHead;    //÷°Õ∑ÃÓ◊∞
  42   1              frameCfmHead[1] = COM_ADDR;       
  43   1              frameCfmHead[2] = BD_addr;
  44   1              frameCfmHead[3] = BD_type;
  45   1              
  46   1              for(loop = 0; loop < COM_RX2_Lenth; loop ++){
  47   2                      
  48   2                      if(!memcmp(frameCfmHead,&UART485_BUF[loop],2)){ //÷°Õ∑±Íº«º∞…Ëπ ∞Â◊®”√Õ®–≈µÿ÷∑–£—È/*µ⁄“ª≤„*/
  49   3              
  50   3                              if(!memcmp(&frameCfmHead[2],&UART485_BUF[loop + 3],2)){ //±æµÿ…Ëπ ∞Âµÿ÷∑º∞±æµÿ…Ëπ ∞Âµÿ÷∑–£—È/*µ⁄∂˛≤„*/ 
             - ÷°Õ∑±Íº«∫Ûµ⁄»˝Œªø™ º
  51   4                              
  52   4                                      corelen         = UART485_BUF[loop + 2];        //÷°Õ∑±Íº«∫Ûµ⁄∂˛Œª±Ì æ÷°∫À≥§∂»
C51 COMPILER V9.54   485TRANS_USART                                                        03/08/2018 16:33:08 PAGE 2   

  53   4                                      if(!memcmp(frameCfmTail,&UART485_BUF[loop + corelen + 2],2)){   //÷°Œ≤–£—È£¨÷°Õ∑±Íº« + …Ëπ ∞Â◊®”√Õ®–≈µÿ÷
             -∑1Œª + ÷°∫À≥§1Œª + œ¬“ªŒª£®‘Ωπ˝µ±«∞Œª£©/*µ⁄»˝≤„*/
  54   5                                      
  55   5                                              memset(COREDATS,0,COREDATS_SIZE * sizeof(u8));                  //÷°∫Àª∫¥Ê«Â¡„
  56   5                                              memcpy(COREDATS,&UART485_BUF[loop + 5],corelen - 2);    //÷°Õ∑∫Ûµ⁄ŒÂŒªŒ™»•µÙµÿ÷∑∫Û÷°∫ÀÕ∑◊÷Ω⁄£¨“‘¥ÀŒ™ø™∂À
             -∏¥÷∆÷°∫À ˝æ›µΩª∫¥Ê
  57   5                                              memset(&UART485_BUF[loop],0,loop + corelen + 5);                //¿˙ ∑ ˝æ›∑œ∆˙«Â¡„  5£∫÷°Õ∑2 + ÷°∫À≥§1 + ÷°Œ≤2
  58   5                                      }                               
  59   4                              }
  60   3                      }
  61   2              }
  62   1      }
  63          
  64          
  65          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    259    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =     23      17
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
   EDATA SIZE       =   ----    ----
   HDATA SIZE       =   ----    ----
   XDATA CONST SIZE =   ----    ----
   FAR CONST SIZE   =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
